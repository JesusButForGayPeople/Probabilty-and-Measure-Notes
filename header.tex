% ======================
% PACKAGE CONFIGURATION
% ======================
\documentclass[12pt]{article}
\usepackage[utf8]{inputenc} 
\usepackage{float}
% Math
\usepackage{amsmath, amssymb, mathtools}
\usepackage{cancel}
\usepackage{needspace}

% Graphics and TikZ
\usepackage{graphicx}
\usepackage{tikz}
\usetikzlibrary{calc, positioning, decorations.pathreplacing, arrows.meta}
\usepackage{environ}


% Layout
\usepackage{geometry}
\geometry{margin=0.75in}
\usepackage{fancyhdr}
\setlength{\headheight}{16.4pt}        % Fix for fancyhdr header size warning
\addtolength{\topmargin}{-2.4pt}       % Optional: counteract added header height

% Fonts and styling
\usepackage[fontsize=14pt]{scrextend}
\usepackage{anyfontsize}
\usepackage{bm}
\usepackage{xfakebold}
\usepackage{xspace}
\newcommand{\fbseries}{\unskip\setBold\aftergroup\unsetBold\aftergroup\ignorespaces}
\newcommand{\setBoldness}[1]{\def\fake@bold{#1}}

\usepackage{stackengine}
\newcommand{\qed}{%
  \stackengine{0pt}{%
    \stackengine{0pt}{%
      \stackengine{0pt}{%
        \textbf{QED}%
      }{%
        \kern0.1pt\textbf{QED}%
      }{O}{l}{F}{T}{L}%
    }{%
      \kern-0.1pt\textbf{QED}%
    }{O}{l}{F}{T}{L}%
  }{%
    \kern0.2pt\textbf{QED}%
  }{O}{l}{F}{T}{L}%
}

\newsavebox{\nosplitbox}
\NewEnviron{nosplit}{%
  \setbox\nosplitbox=\vbox{\BODY}%
  \needspace{\dimexpr\ht\nosplitbox+\dp\nosplitbox+\baselineskip}%
  \usebox{\nosplitbox}%
}



% Lists and layout
\usepackage{array}
\usepackage{enumitem}
\usepackage{wrapfig}
\usepackage{makecell}
\usepackage{booktabs}

% Boxes and framing
\usepackage{mdframed}
\usepackage[most]{tcolorbox}
\tcbuselibrary{skins}

% Document structure
\usepackage{titlesec}
\usepackage{extramarks} % [?] Only needed if using \extramarks
\usepackage{caption}    % [?] Only needed if customizing captions

% Colors
\usepackage[dvipsnames]{xcolor}

% Utility
\usepackage{pifont}
\usepackage{silence}
\usepackage{xparse}

% Hyperlinks (should be last)
\usepackage{hyperref}


% ======================
% COLOR DEFINITIONS
% ======================
\definecolor{mygreen}{RGB}{131, 176, 47}
\definecolor{textgreen}{RGB}{129, 186, 24}
\definecolor{myred}{RGB}{195, 30, 74}
\definecolor{myblue}{RGB}{0, 140, 158}
\definecolor{myorange}{RGB}{240, 110, 41}
\definecolor{mygrey}{RGB}{130, 130, 130}
\definecolor{dark}{HTML}{83B02F}
\definecolor{light}{HTML}{e1f0c7}

% ======================
% SPACING ADJUSTMENTS
% ======================
\setlength{\abovedisplayskip}{5pt}
\setlength{\belowdisplayskip}{5pt}
\setlength{\abovedisplayshortskip}{1pt}
\setlength{\belowdisplayshortskip}{1pt}

% ======================
% CUSTOM ENVIRONMENTS
% ======================
\newenvironment{answer}{
  \begin{list}{}{
    \setlength{\leftmargin}{2cm}
    \setlength{\rightmargin}{0cm}
    \setlength{\listparindent}{0cm}
    \setlength{\itemindent}{0cm}
    \setlength{\parsep}{0pt}
  }
  \item[]
}{
  \end{list}
}

% ======================
% CUSTOM COMMANDS
% ======================
\newcommand{\tikzmark}[1]{\tikz[remember picture, baseline] \node (#1) {};}
\newcommand{\mathbox}[2]{%
  \begingroup
  \setlength{\fboxsep}{4pt}
  \setlength{\fboxrule}{1.2pt}
  \color{#1}
  \fbox{\color{black} $\displaystyle #2$}
  \endgroup
}
\newcommand{\dash}{-\mkern-8mu-}
\newcommand{\mytitle}{TITLE PLACEHOLDER}
\newcommand*{\underuparrow}[1]{\ensuremath{\underset{\uparrow}{#1}}}


\newcommand{\highlight}[1]{%
    \textcolor{textgreen}{\fbseries #1}\xspace%
}
\newcommand{\elbowarrow}{%
  \tikz[baseline=-0.5ex, x=0.4ex, y=0.4ex, line width=0.4pt, line join=round]{
    \def\shaftlen{3}
    \draw
      (-0.25,0) -- (-0.25,\shaftlen) -- (1,\shaftlen)
      -- (1,1) -- (\shaftlen,1)
      -- (\shaftlen,1.75) -- ({\shaftlen + 1.5},0.5) -- (\shaftlen,-0.75) -- (\shaftlen,0)
      -- (1,0) -- cycle;
  }\hspace{0.4em}%
}
\newcommand{\tallbar}{\makebox[0pt][r]{\raisebox{-2em}[0pt][0pt]{\rule{0.5pt}{3.3em}}}}

\newcolumntype{N}{|>{\raggedleft\arraybackslash}p{1.5em}} % Step number
\newcolumntype{S}{|>{\raggedright\arraybackslash}p{0.45\textwidth}} % Statement
\newcolumntype{J}{|>{\raggedright\arraybackslash}p{0.45\textwidth}|} % Justification
\newcolumntype{C}{|>{\raggedright\arraybackslash}p{0.45\textwidth}|}  % Conclusion (no vline)
\newcommand{\btherefore}{\raisebox{-0.65ex}{\(\bullet\)}\kern-0.13ex \raisebox{0.65ex}{\(\bullet\)}\kern-0.13ex \raisebox{-0.65ex}{\(\bullet\)}\kern-0.1em}

% ======================
% LIST AND SECTION FORMATTING
% ======================
\renewcommand{\labelitemii}{$\triangleright$}
\titleformat{\subsection}[runin]{\normalfont\large\bfseries}{\thesubsection}{1em}{}
\renewcommand\CancelColor{\color{red}}

% ======================
% HEADER CONFIGURATION
% ======================
\newcommand{\headertext}{}
\newlength{\headertextwidth}
\newcommand{\autoscaleheader}[1]{%
    \settowidth{\headertextwidth}{#1}%
    \ifdim\headertextwidth>0.55\textwidth
        \renewcommand{\headertext}{\scalebox{0.85}{#1}}%
        \fancyhead[L]{}%
    \else
        \renewcommand{\headertext}{#1}%
        \fancyhead[L]{\today}%
    \fi
}

% ======================
% FIRST PAGE STYLE
% ======================
\fancypagestyle{firstpage}{
  \fancyhf{}
  \fancyhead[L]{Aidan J. Wagner}
  \fancyhead[R]{\today}
  \fancyhead[C]{\mytitle}
  \renewcommand{\headrule}{%
      \hrule height 0.4pt \vspace{3pt}
      \rule{0.5\textwidth}{0.4pt} \\[-13pt]
      \rule{0.25\textwidth}{0.4pt}
      \vspace{-10pt}
  }
}

% ======================
% HEADER/FOOTER SETUP
% ======================
\pagestyle{fancy}
\fancyhf{}
\fancyhead[R]{\thepage}
\fancyhead[C]{\normalsize \headertext}
\fancyhead[L]{\today}
\renewcommand{\headrule}{%
    \vspace{1pt}
    \hrule height 0.4pt \vspace{3pt}
    \rule{0.5\textwidth}{0.4pt} \\[-13pt]
    \rule{0.25\textwidth}{0.4pt}
    \vspace{-10pt}
}
\fancyfoot{}

% ======================
% CUSTOM HEADING LOGIC
% ======================
\makeatletter
\newcommand{\getcleansection}{%
    \expandafter\getcleansection@aux\leftmark\@nil
}
\def\getcleansection@aux#1\@nil{#1}

\newcommand{\@UNsection}[2]{%
    \phantomsection%
    \addcontentsline{toc}{section}{#1}%
    \section*{\scalebox{#2}[#2]{#1}}%
    \markboth{\normalsize #1}{}%
    \autoscaleheader{{\normalsize #1 \quad - \quad}}%
    \ifnum\value{page}=1\else
        \fancyhead[C]{\headertext}%
        \thispagestyle{fancy}%
    \fi
}

\newcommand{\UNsection}{%
    \@ifnextchar\bgroup
        {\@UNsectionWithScale}
        {\@UNsectionDefault}
}
\newcommand{\@UNsectionWithScale}[1]{%
    \@ifnextchar\bgroup
        {\@UNsectionWithScaleAndTitle{#1}}
        {\@UNsection{#1}{1.0}}%
}
\newcommand{\@UNsectionWithScaleAndTitle}[2]{%
    \@UNsection{#1}{#2}%
}
\newcommand{\@UNsectionDefault}[1]{%
    \@UNsection{#1}{1.0}%
}

\newcommand{\@UNsubsection}[2]{%
    \phantomsection%
    \addcontentsline{toc}{subsection}{#1}%
    \subsection*{\scalebox{#2}[#2]{#1}}%
    \markright{#1}%
    \autoscaleheader{{\getcleansection \quad - \quad #1}}%
    \ifnum\value{page}=1\else
        \fancyhead[C]{\headertext}%
        \thispagestyle{fancy}%
    \fi
}
\newcommand{\UNsubsection}{%
    \@ifnextchar\bgroup
        {\@UNsubsectionWithScale}
        {\@UNsubsectionDefault}
}
\newcommand{\@UNsubsectionWithScale}[1]{%
    \@ifnextchar\bgroup
        {\@UNsubsectionWithScaleAndTitle{#1}}
        {\@UNsubsection{#1}{1.0}}%
}
\newcommand{\@UNsubsectionWithScaleAndTitle}[2]{%
    \@UNsubsection{#1}{#2}%
}
\newcommand{\@UNsubsectionDefault}[1]{%
    \@UNsubsection{#1}{1.0}%
}

% ======================
% MULTIHEADING
% ======================
\newcommand{\@multiheading}[3]{%
    \section*{\Large\scalebox{#3}[#3]{#1} \hspace{0.25em} - \textcolor{mygrey}{\large #2}}%
    \vspace{-1em}%
    \markboth{#1}{#2}%
    \autoscaleheader{{#1 \quad - \quad #2}}%
    \ifnum\value{page}=1\else
        \fancyhead[C]{\headertext}%
        \thispagestyle{fancy}%
    \fi
}
\newcommand{\multiheading}{%
    \@ifnextchar\bgroup
        {\@multiheadingWithArgs}
        {\@multiheadingError}
}
\newcommand{\@multiheadingWithArgs}[1]{%
    \@ifnextchar\bgroup
        {\@multiheadingWithSubtitle{#1}}
        {\@multiheading{#1}{}{1.0}}%
}
\newcommand{\@multiheadingWithSubtitle}[2]{%
    \@ifnextchar\bgroup
        {\@multiheadingWithScale{#1}{#2}}
        {\@multiheading{#1}{#2}{1.0}}%
}
\newcommand{\@multiheadingWithScale}[3]{%
    \@multiheading{#1}{#2}{#3}%
}
\newcommand{\@multiheadingError}{%
    \PackageError{multiheading}{Invalid use of \string\multiheading}{Expected two or three arguments.}%
}
\makeatother


\setlength{\parindent}{0pt}


\NewDocumentEnvironment{proofline}{O{0.25em} O{}}{%
  \begin{list}{}{%
    \setlength{\leftmargin}{#1+0.25em}%
    \setlength{\rightmargin}{0pt}%
  }
  \item
  \tcolorbox[
    blanker, breakable,
    left=4mm, right=0mm, top=1mm, bottom=1mm,
    borderline west={1pt}{0mm}{black},
    before upper=\indent, parbox=false,
    #2
  ]
}{%
  \endtcolorbox
  \end{list}
}

\newcommand{\boxeditem}[1]{%
  \begin{tcolorbox}[
    colback=white,
    colframe=black,
    boxrule=0.4pt,
    sharp corners,
    enhanced,
    left=4pt, right=4pt, top=2pt, bottom=2pt,
    box align=base,
    baseline
  ]
  #1
  \end{tcolorbox}
}


\newcounter{eqgroup}    % manually set this
\newcounter{eqwithin}[eqgroup]  % resets when eqgroup changes

\renewcommand{\theeqwithin}{\theeqgroup.\arabic{eqwithin}}  % formats the tag

\newcommand{\seteqgroup}[1]{\setcounter{eqgroup}{#1}\setcounter{eqwithin}{0}} % call this when switching groups

\NewEnviron{UNequation}{
  \vspace{1ex}
  \refstepcounter{eqwithin}
  \begin{equation}
    \tag{\theeqwithin}
    \scalebox{1.25}[1.25]{ $\displaystyle \BODY$ }
  \end{equation}
  \vspace{1ex}
  
}

\newcommand{\medstar}{\mathbin{\scalebox{0.5}[0.5]{$\bigstar$}}}

\usepackage{pifont}
\newcommand{\xmark}{\text{\ding{55}}}%